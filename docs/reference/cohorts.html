<!-- Generated by pkgdown: do not edit by hand -->
<!DOCTYPE html>
<html>
  <head>
  <meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<title>Create cohorts of SSNAP data — cohorts • ssnapstats</title>

<!-- jquery -->
<script src="https://code.jquery.com/jquery-3.1.0.min.js" integrity="sha384-nrOSfDHtoPMzJHjVTdCopGqIqeYETSXhZDFyniQ8ZHcVy08QesyHcnOUpMpqnmWq" crossorigin="anonymous"></script>
<!-- Bootstrap -->

<link href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-BVYiiSIFeK1dGmJRAkycuHAHRg32OmUcww7on3RYdg4Va+PmSTsz/K68vbdEjh4u" crossorigin="anonymous">
<script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js" integrity="sha384-Tc5IQib027qvyjSMfHjOMaLkfuWVxZxUPnCJA7l2mCWNIpG9mGCD8wGNIcPD7Txa" crossorigin="anonymous"></script>

<!-- Font Awesome icons -->
<link href="https://maxcdn.bootstrapcdn.com/font-awesome/4.6.3/css/font-awesome.min.css" rel="stylesheet" integrity="sha384-T8Gy5hrqNKT+hzMclPo118YTQO6cYprQmhrYwIiQ/3axmI1hQomh7Ud2hPOy8SP1" crossorigin="anonymous">

<!-- clipboard.js -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/1.7.1/clipboard.min.js" integrity="sha384-cV+rhyOuRHc9Ub/91rihWcGmMmCXDeksTtCihMupQHSsi8GIIRDG0ThDc3HGQFJ3" crossorigin="anonymous"></script>

<!-- sticky kit -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/sticky-kit/1.1.3/sticky-kit.min.js" integrity="sha256-c4Rlo1ZozqTPE2RLuvbusY3+SU1pQaJC0TjuhygMipw=" crossorigin="anonymous"></script>

<!-- pkgdown -->
<link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script>



<meta property="og:title" content="Create cohorts of SSNAP data — cohorts" />

<meta property="og:description" content="The cohorts command takes source data from the CSV file and
returns a range of different cohorts needed to produce reports or
undertake analysis. The range of cohorts that can be returned is
described below.
The idea is to request all the cohorts you want in a single pass
at the beginning of the analysis process. Some cohorts are
dependent upon other cohorts: this function allows us to
efficiently work out which cohorts need to be kept, and which can
be thrown away after using them to calculate our end products,
saving time and memory versus saving all the cohorts (potentially
wasting vast amounts of memory) or throwing them all away (forcing
multiple passes over the raw data which is computationally
expensive)." />

<meta property="og:image" content="http://strokeaudit.org/logo.png" />
<meta name="twitter:card" content="summary" />



<!-- mathjax -->
<script src='https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML'></script>

<!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->


  </head>

  <body>
    <div class="container template-reference-topic">
      <header>
      <div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar">
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">ssnapstats</a>
        <span class="label label-danger" data-toggle="tooltip" data-placement="bottom" title="Unreleased package">0.0.1</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
        <li>
  <a href="../index.html">
    <span class="fa fa-home fa-lg"></span>
     
  </a>
</li>
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Articles
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
    <li>
      <a href="../articles/01_Structure.html">Explore the structure of SSNAPStats</a>
    </li>
    <li>
      <a href="../articles/02_UsingSSNAPStats.html">Use SSNAPStats to create output data</a>
    </li>
    <li>
      <a href="../articles/03_AddCohortsAndMeasures.html">Add cohorts and measures to SSNAP</a>
    </li>
  </ul>
</li>
      </ul>
      
      <ul class="nav navbar-nav navbar-right">
        <li>
  <a href="https://github.com/SSNAP/SSNAPStats">
    <span class="fa fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
      
    </div><!--/.nav-collapse -->
  </div><!--/.container -->
</div><!--/.navbar -->

      
      </header>

<div class="row">
  <div class="col-md-9 contents">
    <div class="page-header">
    <h1>Create cohorts of SSNAP data</h1>
    <small class="dont-index">Source: <a href='https://github.com/SSNAP/SSNAPStats/blob/master/R/cohorts.R'><code>R/cohorts.R</code></a></small>
    <div class="hidden name"><code>cohorts.Rd</code></div>
    </div>

    <div class="ref-description">
    
    <p>The <code>cohorts</code> command takes source data from the CSV file and
returns a range of different cohorts needed to produce reports or
undertake analysis. The range of cohorts that can be returned is
described below.</p>
<p>The idea is to request all the cohorts you want in a single pass
at the beginning of the analysis process. Some cohorts are
dependent upon other cohorts: this function allows us to
efficiently work out which cohorts need to be kept, and which can
be thrown away after using them to calculate our end products,
saving time and memory versus saving all the cohorts (potentially
wasting vast amounts of memory) or throwing them all away (forcing
multiple passes over the raw data which is computationally
expensive).</p>
    
    </div>

    <pre class="usage"><span class='fu'>cohorts</span>(<span class='no'>ssnap_data</span>, <span class='no'>cohorts_requested</span>, <span class='kw'>period_type</span> <span class='kw'>=</span> <span class='fu'>c</span>(<span class='st'>"months"</span>, <span class='st'>"periods"</span>,
  <span class='st'>"financialyears"</span>), <span class='no'>last_period</span>, <span class='no'>number_of_periods</span>,
  <span class='kw'>group_aggr_cohorts_by</span> <span class='kw'>=</span> <span class='fu'>c</span>(<span class='st'>"team"</span>, <span class='st'>"national"</span>), <span class='kw'>verbose</span> <span class='kw'>=</span> <span class='fl'>FALSE</span>)</pre>
    
    <h2 class="hasAnchor" id="arguments"><a class="anchor" href="#arguments"></a>Arguments</h2>
    <table class="ref-arguments">
    <colgroup><col class="name" /><col class="desc" /></colgroup>
    <tr>
      <th>ssnap_data</th>
      <td><p>This may be either:</p><ul>
<li><p>The filename of a SSNAP CSV file (NB currently only CSV
  files are supported, not encrypted ZIP files).</p></li>
<li><p>A tibble (a loaded data frame created by the ssnapcsv
  function from the SSNAPInterface package).</p></li>
</ul></td>
    </tr>
    <tr>
      <th>cohorts_requested</th>
      <td><p>A vector of strings defining which cohorts
you wish to return. These cohorts can be any or all of the
following:</p><ul>
<li><p><strong>raw72hrs</strong> Returns all the records that will be
  included in the 72hr cohort, filtered by the specified date
  range. Only inpatient records are included (any team beginning
  with 'C' or 'c' is rejected).
  Columns included:
  <ul>
<li><p>ProClinV1Id and PatientId - the anonymised record and
    patient identifiers used for linking records / cohorts</p></li>
<li><p>TeamCode - The team caring for the patient.</p></li>
<li><p>EthnicityCatUK - Ethnicity types in name format,
    UK-wide (so that clashing codes between NI and England are
    differentiated).</p></li>
<li><p>CreatedDateTime (the date and time the record was
    created)</p></li>
<li><p>All columns beginning with S1-S3.</p></li>
<li><p>LockedS1, S2 and S3 (the lock status for each section)</p></li>
</ul></p></li>
<li><p><strong>lockedTo72hrs</strong> Returns all members of the raw72hrs
  cohort that are recorded as locked to 72hrs. Note that if a
  patient moves between teams in the first 72hrs their opening
  record may not be locked to 72hrs and the subsequent team
  may lock the record at 72hrs.
  All columns from <strong>raw72hrs</strong> are returned but the records
  filtered as above.</p></li>
<li><p><strong>firstTeamLockedTo72hrs</strong> Returns the first team in
  a patient's episode that locks the record to 72hrs. We use this
  to calculate 72hr measures. NB this isn't guaranteed to be the
  first team that treats the patient. It uses
  <strong>lockedto72hrs</strong> as the input cohort. All columns are
  preserved.</p></li>
<li><p><strong>firstTeamAdmittingPatient</strong> Returns the team which
  first admitted the patient. All 72hr measures are attributed to
  the team which opened the record. It uses <strong>raw72hrs</strong> to
  find the earliest record ID for each patient.</p></li>
<li><p><strong>team72hrKIs</strong> Takes the first team which
  locked the record to 72hrs (<strong>firstTeamLockedTo72hrs</strong>),
  and calculates the key indicators for the team 72hr cohort.
  We then take these plus the patient ID, and we apply them to
  the admitting team.</p></li>
<li><p><strong>patient72hrKIs</strong> Takes the first team which
  locked the record to 72hrs (<strong>firstTeamLockedTo72hrs</strong>),
  and calculates the key indicators for the patient 72hr cohort.
  We then take these plus the patient ID, and we apply them to all
  teams treating the patient.</p></li>
<li><p><strong>rawPost72hrs</strong> Returns all the records that will
  be included in post-72hr cohorts, filtered by the specified date
  range. Only inpatient records are included (any team beginning
  with 'C' is rejected).
  Columns included:
  <ul>
<li><p>ProClinV1Id and PatientId - the anonymised record and
    patient identifiers used for linking records / cohorts</p></li>
<li><p>TeamCode - The team caring for the patient.</p></li>
<li><p>EthnicityCatUK - Ethnicity types in name format,
    UK-wide (so that clashing codes between NI and England are
    differentiated).</p></li>
<li><p>CreatedDateTime (the date and time the record was
    created)</p></li>
<li><p>All columns beginning with S4-S7.</p></li>
<li><p>LockedS1 - LockedS7 (the lock status for each section)</p></li>
<li><p>LockedS1DateTime - LockedS7DateTime (the date and time
    of locking for each section - this is used to calculate the
    'record lock time' for audit compliance.)</p></li>
<li><p>TransferActionDateTime - the date and time the record
    was transferred (used for audit compliance).</p></li>
</ul></p></li>
<li><p><strong>teamDischargeKIs</strong> Applies the
  aggregation functions for the SSNAP KI and Audit Compliance
  measures for the Team post-72hr (discharge) cohort. This will
  return things like monthly clock start to scan times etc,
  grouped by the TeamCode and period_type parameter below.</p></li>
<li><p><strong>teamPost72hrAllTeamsCohortKIs</strong> This takes all
  patients who are locked to Sections 4 and 7, OR are transferred
  to another team, and applies a number of calculated fields to
  the cohort. These are all marked 'TCKI' for Key Indicators, or
  'AC' for calculated fields which affect audit compliance.</p></li>
<li><p><strong>teamPost72hrAllTeamsAggrKIs</strong> This takes
  <strong>teamPost72hrAllTeamsCohortKIs</strong> as an input, and applies
  the aggregation functions for the Team post-72hr cohort.</p></li>
<li><p><strong>teamAt7Days</strong> This finds either the current team
  that the patient is in at 7 days, or the last patient that the
  team was in (if they were discharged or died within 7 days).</p></li>
<li><p><strong>team7DayCohortKIs</strong> This uses the
  <strong>teamAt7Days</strong> cohort, and applies the information
  gathered on the patient at discharge (to ensure all fields are
  up to date). A series of calculated fields are then created
  based upon this data.</p></li>
<li><p><strong>patientPost72hrCohortKIs</strong> This fetches all the
  patients involved in the patient's care. NB some of those may
  fall outside the search date so we have to link to the raw SSNAP
  data to fetch all the records associated with the episode.</p></li>
<li><p><strong>ssnapScores</strong> This takes the aggregated value
  cohorts and converts KI measures into SSNAP KI scores and
  Domain scores.</p></li>
</ul></td>
    </tr>
    <tr>
      <th>period_type</th>
      <td><p>A string determining what the gap between
time periods should be. The factor should either be 'months',
'periods' or financialyears'. Months and financialyears are
self-explanatory. Periods represent reporting periods - these were
initially quarterly, then were trimesterly, then quarterly again.
Periods are referred to by their numeric number, rather than a
defined time period to avoid confusion in the calcalations.</p></td>
    </tr>
    <tr>
      <th>last_period</th>
      <td><p>The last period. The type of this value will
depend upon the value of period_type If the period_type is
'months' then last_period should be a Date type (the day will be
ignored). If period_type is periods' then this should be a
numeric value starting at 1 (for Q1 2013).
If period_type is 'years' then this should be a numeric value
representing the year at the start of that financial year, eg.
'2013' represents the 2013-4 financial year.</p></td>
    </tr>
    <tr>
      <th>number_of_periods</th>
      <td><p>The number of periods to be fetched in the
report. Common requests for existing reports are 12 months, or the
last 4 reporting periods, although for specific requests different
output might be requested.</p></td>
    </tr>
    <tr>
      <th>group_aggr_cohorts_by</th>
      <td><p>If any of the cohorts supplied use
aggregated data, then this parameter is used to choose the
grouping level. Suitable values are 'team' (default) or 'national'.</p></td>
    </tr>
    <tr>
      <th>verbose</th>
      <td><p>The verbose option allows you to see which cohorts
are produced and which fields requested from each cohorts. This is
intended for developing cohorts and measures, or for optimisation
work.</p></td>
    </tr>
    </table>
    
    <h2 class="hasAnchor" id="value"><a class="anchor" href="#value"></a>Value</h2>

    <p>A named list of data frames containing the requested
cohorts.</p>
    

  </div>
  <div class="col-md-3 hidden-xs hidden-sm" id="sidebar">
    <h2>Contents</h2>
    <ul class="nav nav-pills nav-stacked">
      <li><a href="#arguments">Arguments</a></li>
      
      <li><a href="#value">Value</a></li>
          </ul>

    <h2>Author</h2>
    
Andrew Hill, <a href='mailto:andrew.hill@doctors.org.uk'>andrew.hill@doctors.org.uk</a>

  </div>
</div>

      <footer>
      <div class="copyright">
  <p>Developed by <a href='https://www.linkedin.com/in/andrew-hill-39437177/'>Andrew Hill</a>, <a href='https://www.linkedin.com/in/lizz-paley-b3a509155/'>Lizz Paley</a>, <a href='https://www.linkedin.com/in/victoria-mccurran-69b43b91/'>Victoria McCurran</a>, <a href='https://www.linkedin.com/in/ben-bray-a1380331/'>Ben Bray</a>, <a href='https://www.strokeaudit.org'><img src='https://www.strokeaudit.org/App_Themes/SSNAP/Images/SSNAPlogo.jpg?v=2'></a>.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="http://pkgdown.r-lib.org/">pkgdown</a>.</p>
</div>

      </footer>
   </div>

  

  </body>
</html>

